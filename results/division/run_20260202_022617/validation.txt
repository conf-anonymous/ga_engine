   Compiling ga_engine v0.1.0 (/root/ga_engine)
    Finished `release` profile [optimized] target(s) in 10.41s
     Running `target/release/examples/test_cuda_division_runpod`
╔════════════════════════════════════════════════════════════════════════╗
║     CUDA GPU Homomorphic Division - RunPod Test Suite                 ║
╚════════════════════════════════════════════════════════════════════════╝

Step 1: Initializing CUDA GPU...
CUDA Device: NVIDIA GeForce RTX 4090
  CUDA device initialized (147.50ms)

Step 2: Initializing FHE parameters...
  Parameters: N=4096, 7 primes (max level 6)
  Scale: 2^40

Step 3: Generating cryptographic keys...
  [DEBUG] Creating NTT contexts for 7 primes (parallelized)...
  [CPU] Prime 0: q=1152921504597016577, psi=142119819475847305, omega=351729224921194188
  [CPU] Prime 1: q=1099511799809, psi=233161075628, omega=83678926232
  [CPU] Prime 2: q=1099511922689, psi=56166301416, omega=89966450923
  [DEBUG] NTT contexts created in 0.00s
  [DEBUG] Starting keygen for N=4096, 7 primes
  [DEBUG] Step 1/5: Secret key sampled in 0.00s
  [DEBUG] Step 2/5: Uniform poly sampled in 0.00s
  [DEBUG] Step 3/5: Error poly sampled in 0.00s
  [DEBUG] Step 4/5: Public key computed in 0.01s
  [DEBUG] Step 5/5: Starting evaluation key generation...
  [DEBUG] Step 5/5: Evaluation key generated in 0.07s
  Keys generated in 78.53ms

Step 4: Initializing CUDA CKKS context...

╔═══════════════════════════════════════════════════════════════╗
║           Initializing CUDA CKKS Context                     ║
╚═══════════════════════════════════════════════════════════════╝

CUDA Device: NVIDIA GeForce RTX 4090
Creating NTT contexts for 7 primes...
  [CUDA] Prime 0: q=1152921504597016577, psi=142119819475847305, omega=351729224921194188
CUDA Device: NVIDIA GeForce RTX 4090
  [CUDA] Prime 1: q=1099511799809, psi=233161075628, omega=83678926232
CUDA Device: NVIDIA GeForce RTX 4090
  [CUDA] Prime 2: q=1099511922689, psi=56166301416, omega=89966450923
CUDA Device: NVIDIA GeForce RTX 4090
CUDA Device: NVIDIA GeForce RTX 4090
CUDA Device: NVIDIA GeForce RTX 4090
  Created 5/7 NTT contexts
CUDA Device: NVIDIA GeForce RTX 4090
CUDA Device: NVIDIA GeForce RTX 4090
  Created 7/7 NTT contexts
  [CUDA CKKS] NTT contexts created in 1.67s
Loading RNS CUDA kernels...
Caching twiddles and moduli on GPU for batched NTT...
  ✓ Cached 896KB twiddles, psi powers, and 7 moduli on GPU in 0.013s
  [CUDA CKKS] ✓ GPU-only CKKS context ready!

  CUDA context ready in 1734.21ms

Step 5: Generating CUDA relinearization keys...

╔═══════════════════════════════════════════════════════════════╗
║        Initializing CUDA Relinearization Keys                ║
╚═══════════════════════════════════════════════════════════════╝

Relinearization key parameters:
  Base w: 2^16 = 65536
  Number of primes (key level): 7
  Number of gadget digits (dnum): 20

Generating relinearization key...
  Generated 5/20 key switching components
  Generated 10/20 key switching components
  Generated 15/20 key switching components
  Generated 20/20 key switching components
  Relinearization key generated in 0.08s

  Relinearization keys generated in 80.48ms

════════════════════════════════════════════════════════════════════════
TEST 1: Ciphertext Multiplication + Rescaling
════════════════════════════════════════════════════════════════════════

Test: 2.0 * 3.0 = 6.0

  Encoding and encrypting...
  Encrypted at level 6

  Performing GPU multiplication with relinearization...
  GPU multiplication completed in 263.44ms
  Level after multiply+rescale: 5

  Decrypting and decoding...

Results:
  Expected:     6.0000000000
  Computed:     6.0000000174
  Error:        1.74e-8
  Rel. Error:   2.91e-9
  PASS - Multiplication working correctly

════════════════════════════════════════════════════════════════════════
TEST 2: Newton-Raphson Inverse
════════════════════════════════════════════════════════════════════════

Test: 1/4.0 = 0.2500
Initial guess: 0.25

  Encrypted input at level 6

  Running Newton-Raphson iteration (2 iterations)...

╔═══════════════════════════════════════════════════════════════╗
║        CUDA GPU Newton-Raphson Inverse                       ║
╚═══════════════════════════════════════════════════════════════╝

  Initial guess: 0.25
  Iterations: 2
  Initial level: 6
  Encrypted initial guess at level 6

  Newton-Raphson iteration 1/2...
    Computed a·x_n (level 5)
    Created trivial ciphertext for 2.0 (level 5)
    Computed 2 - a·x_n (level 5)
    Mod-switching ct_xn from level 6 to 5
    Iteration complete (level 4)

  Newton-Raphson iteration 2/2...
    Mod-switching ct_a from level 6 to 4
    Computed a·x_n (level 3)
    Created trivial ciphertext for 2.0 (level 3)
    Computed 2 - a·x_n (level 3)
    Mod-switching ct_xn from level 4 to 3
    Iteration complete (level 2)

Newton-Raphson inverse complete!
   Final level: 2
   Depth consumed: 4

  Newton-Raphson completed in 1145.10ms
  Final level: 2

Results:
  Expected:     0.2500000000
  Computed:     0.2500000008
  Error:        8.46e-10
  Rel. Error:   3.39e-9
  PASS - Inverse computation working

════════════════════════════════════════════════════════════════════════
TEST 3: Complete Homomorphic Division
════════════════════════════════════════════════════════════════════════

Test: 100.0 / 7.0 = 14.2857142857
Initial guess for 1/7: 0.142857

  Encrypted numerator and denominator at level 6

  Performing complete GPU division...

╔═══════════════════════════════════════════════════════════════╗
║        CUDA GPU Homomorphic Division                         ║
╚═══════════════════════════════════════════════════════════════╝

Step 1: Computing 1/denominator...

╔═══════════════════════════════════════════════════════════════╗
║        CUDA GPU Newton-Raphson Inverse                       ║
╚═══════════════════════════════════════════════════════════════╝

  Initial guess: 0.14285714285714285
  Iterations: 2
  Initial level: 6
  Encrypted initial guess at level 6

  Newton-Raphson iteration 1/2...
    Computed a·x_n (level 5)
    Created trivial ciphertext for 2.0 (level 5)
    Computed 2 - a·x_n (level 5)
    Mod-switching ct_xn from level 6 to 5
    Iteration complete (level 4)

  Newton-Raphson iteration 2/2...
    Mod-switching ct_a from level 6 to 4
    Computed a·x_n (level 3)
    Created trivial ciphertext for 2.0 (level 3)
    Computed 2 - a·x_n (level 3)
    Mod-switching ct_xn from level 4 to 3
    Iteration complete (level 2)

Newton-Raphson inverse complete!
   Final level: 2
   Depth consumed: 4

Step 2: Mod-switching numerator from level 6 to 2
Step 3: Multiplying numerator by (1/denominator)...

Division complete!
   Final level: 1
   Total depth consumed: 5

  GPU division completed in 1344.09ms
  Final level: 1

Results:
  Expected:     14.2857142857
  Computed:     14.2857143450
  Error:        5.93e-8
  Rel. Error:   4.15e-9
  PASS - Division working correctly

════════════════════════════════════════════════════════════════════════
PERFORMANCE SUMMARY
════════════════════════════════════════════════════════════════════════

Operation Timings:
  Key Generation:      78.53ms
  Relin Key Gen:       80.48ms
  Multiplication:      263.44ms
  Newton-Raphson:      1145.10ms
  Complete Division:   1344.09ms

════════════════════════════════════════════════════════════════════════
ALL TESTS PASSED - CUDA GPU DIVISION FULLY FUNCTIONAL
════════════════════════════════════════════════════════════════════════

Implementation Status: READY FOR PRODUCTION
GPU Acceleration: VERIFIED

